# Summary: Task 2.4.2 - Implement size/1 Callback

**Branch:** `feature/2.4.2-size-callback`
**Date:** 2025-12-05
**Status:** Complete

## Overview

Implemented the `size/1` callback for the Raw backend to query terminal dimensions. This callback returns the cached size from state, providing a simple accessor for the dimensions captured at initialization.

## Implementation

### size/1

Returns cached terminal dimensions from state:
- Returns `{:ok, {rows, cols}}` tuple
- Does not re-query the terminal (use `refresh_size/1` for that)
- Dimensions are in `{rows, cols}` format (rows first)

### Code Changes

```elixir
@impl true
@doc """
Returns the current terminal dimensions.

Returns the cached size from state as `{rows, cols}`. This does not
re-query the terminal - it returns the dimensions captured at `init/1`
or last updated by `refresh_size/1`.

## Return Value

- `{:ok, {rows, cols}}` - Terminal dimensions (rows first, then columns)

## Examples

    {:ok, {24, 80}} = Raw.size(state)  # Standard 80x24 terminal
    {:ok, {50, 120}} = Raw.size(state) # Larger terminal

## See Also

- `refresh_size/1` - Re-query terminal dimensions (call after SIGWINCH)
- `init/1` - Initial size detection
"""
@spec size(t()) :: {:ok, TermUI.Backend.size()} | {:error, :enotsup}
def size(state) do
  {:ok, state.size}
end
```

## Tests Added

5 new tests in `describe "size/1 callback"`:

| Test | Description |
|------|-------------|
| returns {:ok, {rows, cols}} tuple | Basic return value format |
| returns cached dimensions from state | Verifies state.size is returned |
| works with various terminal sizes | Tests 80x24, 200x50, 40x10 |
| size remains unchanged after cursor operations | Integration test |
| returns size in {rows, cols} format | Verifies row/column ordering |

## Files Modified

| File | Changes |
|------|---------|
| `lib/term_ui/backend/raw.ex` | Enhanced size/1 documentation (+20 lines) |
| `test/term_ui/backend/raw_test.exs` | Added 5 tests (+40 lines) |
| `notes/planning/multi-renderer/phase-02-raw-backend.md` | Marked tasks 2.4.2.1-2 complete |

## Verification

- `mix compile` - Compiles without warnings
- `mix test test/term_ui/backend/raw_test.exs` - 93 tests pass (5 new)
- `mix format --check-formatted` - Code properly formatted

## Design Notes

### Stub Was Already Correct

The existing stub implementation `{:ok, state.size}` was functionally complete. This task primarily added:
1. Comprehensive documentation with examples
2. Cross-references to related functions
3. Unit tests verifying behavior

### Subtasks 2.4.2.3-4 Deferred

Subtasks 2.4.2.3 (refresh_size/1) and 2.4.2.4 (error handling for size queries) are more appropriately covered in Task 2.4.3, which implements the actual terminal size re-query functionality.

## Impact

- **Subtasks completed**: 2.4.2.1, 2.4.2.2
- **Section 2.4 progress**: 2 of 3 tasks complete (2.4.3 refresh_size/1 remaining)
- **No breaking changes**: Enhanced existing stub with documentation and tests
