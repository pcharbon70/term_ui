# Summary: Section 7.3 - Terminal Resize Handling

## What Was Implemented

This section completes terminal resize handling, allowing TUI applications to adapt when the terminal window is resized.

### Modified Modules

1. **`TermUI.Runtime`** (`lib/term_ui/runtime.ex`)
   - Register for resize callbacks in `init/1`
   - Unregister from resize callbacks in `terminate/2`
   - Added `handle_info` for `{:terminal_resize, {rows, cols}}`
   - Added `handle_resize/3` function that:
     - Updates `Runtime.State.dimensions`
     - Calls `BufferManager.resize/3`
     - Clears screen to avoid artifacts
     - Broadcasts `Event.Resize` to all components
     - Forces immediate re-render

### New Test File

- `test/term_ui/runtime/resize_test.exs` - 5 tests

## Architecture

```
Terminal (SIGWINCH) → {:terminal_resize, ...} → Runtime → BufferManager.resize
                                                       → Event.Resize broadcast
                                                       → force re-render
```

## Existing Infrastructure Used

The Terminal module already had:
- SIGWINCH handling (line 365-366)
- `register_resize_callback/1`
- `unregister_resize_callback/1`

BufferManager already had:
- `resize/3` function

## Implementation Details

### Resize Flow

1. Terminal receives SIGWINCH signal
2. Terminal queries new size and sends `{:terminal_resize, {rows, cols}}`
3. Runtime `handle_info` receives the message
4. `handle_resize/3` is called which:
   - Updates `state.dimensions` to `{cols, rows}`
   - Calls `BufferManager.resize(pid, rows, cols)`
   - Writes `ESC[2J` to clear screen
   - Creates `Event.Resize.new(cols, rows)`
   - Broadcasts resize event to all components
   - Sets `dirty: true` and calls `do_render/1`

### Event.Resize

Components receive `Event.Resize` with:
- `width` - New terminal width in columns
- `height` - New terminal height in rows
- `timestamp` - When the resize occurred

## Usage

Components can respond to resize events:

```elixir
def event_to_msg(%Event.Resize{width: w, height: h}, _state) do
  {:msg, {:resize, w, h}}
end

def update({:resize, width, height}, state) do
  # Recalculate layout for new dimensions
  %{state | width: width, height: height}
end
```

## Testing

### Test Coverage (5 tests)
- Runtime handles terminal_resize message
- Event.Resize created with correct dimensions
- Event.Resize struct default values
- Event.Resize.new/2 creates event
- Event.Resize.new/3 accepts timestamp option

### Test Results
- All 5 new tests pass
- All 2806 total tests pass (no regressions)

## Technical Notes

1. **Screen Clear**: Writing `ESC[2J` before re-render prevents artifacts from the old buffer size.

2. **Immediate Render**: Calling `do_render/1` directly rather than waiting for next tick improves user experience.

3. **Dimension Order**: Terminal sends `{rows, cols}` but we store as `{cols, rows}` (width, height) for consistency with Event.Resize.

4. **Skip Terminal**: When `skip_terminal: true` (tests), resize handling is skipped to avoid errors.

## Files Changed

- Modified: `lib/term_ui/runtime.ex` (added resize handling)
- Created: `test/term_ui/runtime/resize_test.exs`
- Created: `notes/features/7.3-terminal-resize-handling.md`
