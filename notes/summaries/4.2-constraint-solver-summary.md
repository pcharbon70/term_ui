# Summary: Section 4.2 Constraint Solver

## Overview

Implemented a Cassowary-inspired constraint solver that translates constraint types into concrete cell positions and sizes. The solver uses a greedy multi-pass algorithm optimized for common layout patterns.

## Changes Made

### New Files

- `lib/term_ui/layout/solver.ex` - Constraint solver module
- `test/term_ui/layout/solver_test.exs` - Comprehensive unit tests (43 tests)

### Implementation Details

#### Core Algorithm

The solver processes constraints in priority order:
1. **Fixed pass** - Allocate length constraints exactly
2. **Percentage pass** - Calculate from total available space
3. **Ratio/Fill pass** - Distribute remaining space proportionally

#### Main Functions

| Function | Purpose |
|----------|---------|
| `solve/2` | Returns list of sizes from constraints |
| `solve_to_rects/3` | Returns positioned rectangles |
| `solve_horizontal/3` | Shorthand for horizontal layout |
| `solve_vertical/3` | Shorthand for vertical layout |

#### Conflict Resolution

When constraints exceed available space:
- Min bounds have highest priority
- Proportional reduction for reducible items
- Logging warnings for conflicts
- Scale proportionally as last resort

#### Fast Paths

Optimized handling for common cases:
- All-fixed layouts (simple sum)
- Single-fill layouts (subtraction)

#### Position Calculation

- Converts sizes to positioned rectangles
- Supports gaps between elements
- Works with both directions (horizontal/vertical)
- Handles area offsets correctly

## Test Coverage

43 unit tests covering:
- Basic constraint solving (length, percentage, ratio, fill)
- Mixed constraint combinations
- Bounded constraints (min/max)
- Conflict resolution scenarios
- Two-dimensional layouts
- Position calculation
- Non-overlapping verification
- Performance benchmarks

Performance tests confirm:
- 1000 solves in < 100ms
- Rectangle calculation adds minimal overhead

## Design Decisions

1. **Greedy multi-pass** - deterministic, predictable results
2. **Independent dimensions** - solve width and height separately
3. **Priority-based conflict resolution** - min > fixed > percentage > ratio
4. **Fast paths** - optimize common cases without affecting correctness
5. **Warning logs** - aid debugging without failing

## Integration Points

This module will be used by:
- Section 4.3: Layout Cache (caching solver results)
- Section 4.4: Flexbox Alignment (position adjustments)
- Container components for child positioning

## Usage Examples

```elixir
alias TermUI.Layout.{Constraint, Solver}

# Basic solving
constraints = [
  Constraint.length(20),
  Constraint.fill()
]
sizes = Solver.solve(constraints, 100)
# => [20, 80]

# Three-pane layout
constraints = [
  Constraint.length(200),
  Constraint.ratio(1),
  Constraint.ratio(2)
]
sizes = Solver.solve(constraints, 1000)
# => [200, 267, 533]

# Get positioned rectangles
area = %{x: 0, y: 0, width: 100, height: 10}
rects = Solver.solve_to_rects(constraints, area)
# => [%{x: 0, y: 0, width: 20, height: 10}, ...]

# With gaps
rects = Solver.solve_to_rects(constraints, area, gap: 5)

# Vertical layout
rects = Solver.solve_vertical(constraints, area)
```

## Files Modified

- `notes/features/4.2-constraint-solver.md` - marked all tasks complete

## How to Test

```bash
mix test test/term_ui/layout/solver_test.exs
```

## Next Steps

- Section 4.3: Layout Cache - cache solver results for performance
- Section 4.4: Flexbox Alignment - alignment within allocated space
