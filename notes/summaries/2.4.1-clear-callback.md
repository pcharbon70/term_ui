# Summary: Task 2.4.1 - Implement clear/1 Callback

**Branch:** `feature/2.4.1-clear-callback`
**Date:** 2025-12-05
**Status:** Complete

## Overview

Implemented the `clear/1` callback for the Raw backend to clear the entire screen and reset cursor position to home. This is an essential screen management operation.

## Implementation

### clear/1

Clears the entire screen and moves cursor to home position:
- Writes `\e[2J` (ED - Erase Display, parameter 2: clear entire screen)
- Writes `\e[1;1H` (CUP - Cursor Position: row 1, column 1)
- Resets `current_style` to `nil` (terminal style state unknown after clear)
- Updates `cursor_position` to `{1, 1}`

### Code Changes

```elixir
def clear(state) do
  # Write clear screen sequence followed by cursor home
  write_to_terminal([ANSI.clear_screen(), ANSI.cursor_position(1, 1)])

  # Reset style state (unknown after clear) and set cursor to home
  updated_state = %{state | current_style: nil, cursor_position: {1, 1}}

  {:ok, updated_state}
end
```

## Tests Added

6 new tests in `describe "clear/1 callback"`:

| Test | Description |
|------|-------------|
| returns {:ok, state} | Basic return value check |
| resets cursor_position to {1, 1} | Verifies cursor moves to home |
| resets current_style to nil | Verifies style state is cleared |
| preserves other state fields | No unintended state changes |
| works after multiple operations | Integration test |
| is idempotent (multiple clears work) | Can be called repeatedly |

## Files Modified

| File | Changes |
|------|---------|
| `lib/term_ui/backend/raw.ex` | Implemented clear/1 (+18 lines) |
| `test/term_ui/backend/raw_test.exs` | Added 6 tests (+65 lines) |
| `notes/planning/multi-renderer/phase-02-raw-backend.md` | Marked task 2.4.1 complete |

## Verification

- `mix compile` - Compiles without warnings
- `mix test test/term_ui/backend/raw_test.exs` - 89 tests pass (6 new)
- `mix format --check-formatted` - Code properly formatted

## Design Decisions

### Style State Reset

After a screen clear, the terminal's style state is unknown. Some terminals reset styles on clear, others don't. Setting `current_style` to `nil` forces subsequent rendering to re-establish style, ensuring consistency.

### Batched I/O

Both sequences are written in a single `write_to_terminal/1` call using an iolist for efficiency.

## Impact

- **Subtasks completed**: 2.4.1.1-5 (all 5 subtasks)
- **Section 2.4 progress**: 1 of 3 tasks complete (2.4.2 size/1 and 2.4.3 refresh_size/1 remaining)
- **No breaking changes**: Existing stub behavior replaced with full implementation
