# Summary: Task 2.3.2 - Implement hide_cursor/1 and show_cursor/1 Callbacks

**Branch:** `feature/2.3.2-cursor-visibility`
**Date:** 2025-12-05
**Status:** Complete

## Overview

Implemented cursor visibility control callbacks for the Raw backend, enabling hiding and showing the terminal cursor with idempotent behavior.

## Implementation

### hide_cursor/1

- Pattern matches on `cursor_visible: false` for idempotent no-op
- Writes `\e[?25l` (DECTCEM off) via `ANSI.cursor_hide/0`
- Updates state with `cursor_visible: false`

### show_cursor/1

- Pattern matches on `cursor_visible: true` for idempotent no-op
- Writes `\e[?25h` (DECTCEM on) via `ANSI.cursor_show/0`
- Updates state with `cursor_visible: true`

### Code Changes

```elixir
def hide_cursor(%__MODULE__{cursor_visible: false} = state) do
  # Already hidden - idempotent no-op
  {:ok, state}
end

def hide_cursor(state) do
  write_to_terminal(ANSI.cursor_hide())
  {:ok, %{state | cursor_visible: false}}
end

def show_cursor(%__MODULE__{cursor_visible: true} = state) do
  # Already visible - idempotent no-op
  {:ok, state}
end

def show_cursor(state) do
  write_to_terminal(ANSI.cursor_show())
  {:ok, %{state | cursor_visible: true}}
end
```

## Tests Added

10 new tests across 3 describe blocks:

### hide_cursor/1 callback (4 tests)
| Test | Description |
|------|-------------|
| returns {:ok, state} | Basic return value check |
| updates cursor_visible to false | Verifies state mutation |
| is idempotent when cursor already hidden | No-op when already hidden |
| preserves other state fields | No unintended state changes |

### show_cursor/1 callback (4 tests)
| Test | Description |
|------|-------------|
| returns {:ok, state} | Basic return value check |
| updates cursor_visible to true | Verifies state mutation |
| is idempotent when cursor already visible | No-op when already visible |
| preserves other state fields | No unintended state changes |

### cursor visibility round-trip (2 tests)
| Test | Description |
|------|-------------|
| hide then show restores visibility | Round-trip test |
| multiple hide/show cycles work correctly | Stress test with 4 operations |

## Files Modified

| File | Changes |
|------|---------|
| `lib/term_ui/backend/raw.ex` | Implemented hide_cursor/1 and show_cursor/1 (+26 lines) |
| `test/term_ui/backend/raw_test.exs` | Added 10 tests (+113 lines) |
| `notes/planning/multi-renderer/phase-02-raw-backend.md` | Marked task 2.3.2 complete |

## Verification

- `mix compile` - Compiles without warnings
- `mix test test/term_ui/backend/raw_test.exs` - 69 tests pass (10 new)
- `mix format --check-formatted` - Code properly formatted

## Design Decisions

### Idempotent Operations

Used pattern matching on struct fields to implement idempotent behavior:
- Avoids unnecessary terminal I/O
- Allows callers to call without tracking current state
- Returns exact same state object when already in desired state

### ANSI Sequences

- `\e[?25l` - DECTCEM (DEC Text Cursor Enable Mode) off
- `\e[?25h` - DECTCEM on

These are standard VT220 sequences supported by all modern terminals.

## Impact

- **Subtasks completed**: 2.3.2.1-5 (all 5 subtasks)
- **Section 2.3 progress**: 2 of 3 tasks complete (2.3.3 cursor optimization remaining)
- **No breaking changes**: Existing stub contract maintained
