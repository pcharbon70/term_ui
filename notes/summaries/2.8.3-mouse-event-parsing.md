# Summary: Task 2.8.3 - Implement Mouse Event Parsing

**Branch:** `feature/2.8.3-mouse-event-parsing`
**Date:** 2025-12-05
**Status:** Complete

## Overview

Task 2.8.3 required implementing mouse event parsing in `poll_event/2`. The parsing was **already implemented** in `EscapeParser`. This task documents the implementation and adds comprehensive tests.

This task also marks **Section 2.8 (Mouse Tracking) as complete**.

## Implementation Summary

### SGR Mouse Sequence Format

```
ESC [ < Cb ; Cx ; Cy M  (press)
ESC [ < Cb ; Cx ; Cy m  (release)
```

Where:
- `Cb` = button byte (encodes button, modifiers, scroll, motion)
- `Cx` = column (1-indexed)
- `Cy` = row (1-indexed)

### Button Byte Decoding

| Bits | Value | Meaning |
|------|-------|---------|
| 0-1  | 0     | Left button |
| 0-1  | 1     | Middle button |
| 0-1  | 2     | Right button |
| 2    | 4     | Shift modifier |
| 3    | 8     | Alt modifier |
| 4    | 16    | Ctrl modifier |
| 5    | 32    | Motion (drag) |
| 6    | 64    | Scroll wheel |

### Implementation Location

All parsing is in `lib/term_ui/terminal/escape_parser.ex`:
- `parse_csi_sequence/1` line 219: Detects `<` prefix
- `parse_sgr_mouse/1` lines 260-276: Parses sequence
- `decode_mouse_event/4` lines 322-366: Decodes button byte and constructs event

## Files Modified

| File | Lines Changed |
|------|---------------|
| `test/term_ui/backend/raw_test.exs` | +138 (13 tests for mouse parsing) |
| `notes/planning/multi-renderer/phase-02-raw-backend.md` | Mark Section 2.8 complete |
| `notes/features/2.8.3-mouse-event-parsing.md` | Created |

## Test Coverage

13 new tests covering:
- Left/middle/right button press
- Button release
- Scroll up/down
- Drag events
- Shift/Alt/Ctrl modifiers
- Multiple modifiers combined
- Incomplete sequence handling
- Coordinate conversion (1-indexed to 0-indexed)

## Verification

- `mix compile` - no warnings
- 174 tests pass (13 new)
- `mix format --check-formatted` - properly formatted

## Section 2.8 Completion

With Task 2.8.3 complete, **Section 2.8 (Mouse Tracking) is now fully complete**:

- [x] Task 2.8.1: enable_mouse/2
- [x] Task 2.8.2: disable_mouse/1
- [x] Task 2.8.3: Mouse event parsing
- [x] Unit Tests 2.8

## Next Steps

The next section in Phase 2 is:
- **Section 2.9: Integration Tests**

This section will add integration tests for full lifecycle scenarios.
