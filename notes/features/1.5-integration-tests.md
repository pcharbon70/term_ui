# Feature 1.5: Integration Tests

## Overview

Integration tests verify that all Phase 1 modules work together correctly. These tests exercise the full backend selection flow from configuration through selector, testing that Config, Selector, and State modules integrate properly.

## Reference

- Phase plan: `notes/planning/multi-renderer/phase-01-backend-selector.md`
- Section: 1.5 Integration Tests
- Part of: Phase 1 - Backend Selector and Behaviour Definition

## Dependencies

- Section 1.1: Backend Behaviour (complete)
- Section 1.2: Backend Selector (complete)
- Section 1.3: Backend State (complete)
- Section 1.4: Configuration Module (complete)

## Subtasks

### Task 1.5.1: Backend Selection Flow Tests

Test the complete flow from configuration to backend selection.

- [x] 1.5.1.1 Test configuration with `:auto` backend triggers selector
- [x] 1.5.1.2 Test selector result provides correct backend module and init options
- [x] 1.5.1.3 Test explicit backend configuration bypasses selector
- [x] 1.5.1.4 Test invalid configuration is caught before selector runs

### Task 1.5.2: Capability Integration Tests

Test capability detection integrates correctly.

- [x] 1.5.2.1 Test TTY capability detection produces compatible capability format
- [x] 1.5.2.2 Test capability map can be passed to TTY backend init
- [x] 1.5.2.3 Test environment variable changes affect capability detection

### Task 1.5.3: State Management Tests

Test state management across the selection flow.

- [x] 1.5.3.1 Test `Backend.State` correctly wraps selector results
- [x] 1.5.3.2 Test state updates preserve backend-specific state
- [x] 1.5.3.3 Test mode field correctly reflects selection result

## Implementation Notes

### Test File Location
Create `test/integration/backend_selection_test.exs` as specified in the phase plan.

### Test Strategy
- Use mocks for `:shell.start_interactive/1` to simulate both raw and TTY scenarios
- Test environment variable manipulation for capability detection
- Verify module interactions without requiring actual terminal access

### Modules Under Test
- `TermUI.Backend.Config` - Configuration reading/validation
- `TermUI.Backend.Selector` - Backend selection logic
- `TermUI.Backend.State` - State management

## Files to Create

- `test/integration/backend_selection_test.exs` - Integration test suite
