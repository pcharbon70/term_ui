# Feature 1.2.2: Core Selection Logic

## Overview

Implement the core selection logic in `try_raw_mode/0` that attempts to start raw mode using `:shell.start_interactive({:noshell, :raw})` and falls back to TTY mode when unavailable.

## Reference

- Phase plan: `notes/planning/multi-renderer/phase-01-backend-selector.md`
- Task: 1.2.2 Implement Core Selection Logic

## Subtasks

- [x] 1.2.2.1 Implement `select/0` function calling `:shell.start_interactive({:noshell, :raw})`
- [x] 1.2.2.2 Handle `:ok` return by returning `{:raw, %{raw_mode_started: true}}`
- [x] 1.2.2.3 Handle `{:error, :already_started}` return by calling `detect_tty_capabilities/0` and returning `{:tty, capabilities}`
- [x] 1.2.2.4 Wrap call in try/rescue to handle `UndefinedFunctionError` on pre-OTP 28 systems (fall back to TTY)

## Implementation Notes

- `:shell.start_interactive/1` is only available in OTP 28+
- The function returns `:ok` on success or `{:error, :already_started}` if a shell is running
- On pre-OTP 28 systems, calling the function raises `UndefinedFunctionError`
- We use try/rescue to gracefully handle the undefined function case

## Testing Strategy

Since we cannot easily mock `:shell.start_interactive/1` in tests:
- Test the fallback behavior (pre-OTP 28) using a helper function
- Test return value formats are correct
- Test that `detect_capabilities/0` is called in TTY fallback path
- Use `@tag :requires_otp_28` for tests that need actual raw mode

## Files Modified

- `lib/term_ui/backend/selector.ex` - Implement `try_raw_mode/0`
- `test/term_ui/backend/selector_test.exs` - Add tests for core selection logic
