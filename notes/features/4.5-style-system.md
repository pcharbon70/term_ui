# Feature Plan: 4.5 Style System

## Problem Statement

Components need consistent visual presentation across the application. Without a style system:
- Colors must be manually specified everywhere
- Text attributes (bold, italic, etc.) are inconsistent
- No inheritance from parent components
- No way to define component state variants (focused, disabled)
- Theme integration is impossible

The style system provides the foundation for visual consistency.

## Solution Overview

Implement a comprehensive style system supporting:
- **Color System** - 16 named, 256 palette, RGB true color with conversion
- **Text Attributes** - bold, italic, underline, etc. as composable set
- **Style Structure** - immutable struct with builder pattern
- **Style Inheritance** - cascade from parent to child
- **Style Variants** - normal, focused, disabled, etc.

### Key Design Decisions

- **Immutable styles** - modifications return new styles
- **Builder pattern** - ergonomic construction with piping
- **MapSet for attributes** - efficient combination
- **Graceful degradation** - convert colors for limited terminals

## Technical Details

### File Structure

```
lib/term_ui/
├── style.ex                # Main style module
└── style/
    ├── color.ex            # Color types and conversion
    └── attributes.ex       # Text attributes

test/term_ui/
├── style_test.exs          # Style tests
└── style/
    ├── color_test.exs      # Color tests
    └── attributes_test.exs # Attribute tests
```

### Dependencies

- Phase 2 Renderer (Cell has style properties)
- Will be used by Theme System (Section 4.6)
- Will be used by all widgets

## Implementation Plan

### Task 4.5.1: Color System

Support all terminal color modes.

- [x] 4.5.1.1 Implement named color atoms (black, red, green, etc. + bright variants)
- [x] 4.5.1.2 Implement indexed colors 0-255 for 256-color palette
- [x] 4.5.1.3 Implement RGB colors as {r, g, b} tuples
- [x] 4.5.1.4 Implement color conversion (RGB → 256 → 16)
- [x] 4.5.1.5 Implement semantic colors (primary, success, warning, error)

### Task 4.5.2: Text Attributes

Modifiers for text appearance.

- [x] 4.5.2.1 Implement attribute set as MapSet of atoms
- [x] 4.5.2.2 Implement attribute toggling (bold, underline, etc.)
- [x] 4.5.2.3 Implement attribute merging
- [x] 4.5.2.4 Implement attribute clearing

### Task 4.5.3: Style Structure

Main Style struct with builder pattern.

- [x] 4.5.3.1 Define Style struct (fg, bg, attrs)
- [x] 4.5.3.2 Implement Style.new/0 returning default style
- [x] 4.5.3.3 Implement builder functions (fg/2, bg/2, bold/1, etc.)
- [x] 4.5.3.4 Implement Style.merge/2 with precedence

### Task 4.5.4: Style Inheritance

Cascade styles from parent to child.

- [x] 4.5.4.1 Implement selective inheritance (only unset properties)
- [x] 4.5.4.2 Implement style resolution merging inherited and local
- [x] 4.5.4.3 Implement inheritance breaking (reset to defaults)

### Task 4.5.5: Style Variants

Different styles for component states.

- [x] 4.5.5.1 Implement variant map structure
- [x] 4.5.5.2 Implement variant selection based on state
- [x] 4.5.5.3 Implement variant inheritance from normal
- [x] 4.5.5.4 Implement custom variant definition

### Unit Tests

- [x] Test named colors map correctly
- [x] Test color conversion produces similar results
- [x] Test text attributes combine correctly
- [x] Test style builder produces correct structure
- [x] Test style merge with precedence
- [x] Test inheritance resolves unset from parent
- [x] Test variants select correct style

## Success Criteria

1. All color modes supported (16, 256, RGB)
2. Color conversion produces visually similar results
3. Text attributes combine correctly
4. Style builder is ergonomic with piping
5. Style merge handles precedence correctly
6. Inheritance resolves unset properties
7. Variants work for all component states
8. All unit tests pass

## Current Status

**Status**: Complete

### How to Run
```bash
mix test test/term_ui/style_test.exs
```

## Notes

### Color Type

```elixir
@type color ::
  :black | :red | :green | :yellow | :blue | :magenta | :cyan | :white |
  :bright_black | :bright_red | ... |
  {:indexed, 0..255} |
  {:rgb, 0..255, 0..255, 0..255}
```

### Style Structure

```elixir
%Style{
  fg: color() | nil,
  bg: color() | nil,
  attrs: MapSet.t(attr())
}
```

### Example Usage

```elixir
alias TermUI.Style

# Build a style
style = Style.new()
  |> Style.fg(:blue)
  |> Style.bg(:white)
  |> Style.bold()
  |> Style.underline()

# Merge styles (later overrides earlier)
merged = Style.merge(base_style, override_style)

# Inherit from parent
effective = Style.inherit(child_style, parent_style)

# Get variant
focused_style = Style.get_variant(variants, :focused)
```
