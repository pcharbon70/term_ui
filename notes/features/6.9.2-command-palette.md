# Feature: CommandPalette Widget (6.9.2)

## Problem Statement

TermUI needs a VS Code-style command palette for power-user command discovery and execution. Users should be able to quickly search and execute commands without memorizing keyboard shortcuts.

## Solution Overview

Implement a CommandPalette widget that:
- Displays as a modal overlay with search input
- Provides fuzzy search with scoring algorithm
- Supports command categories with prefixes (>, @, #, :)
- Tracks recent commands for quick access
- Shows keyboard shortcut hints
- Supports nested command menus
- Supports async command loading for dynamic sources

## Technical Details

### Files to Create
- `lib/term_ui/widgets/command_palette.ex` - Main CommandPalette widget
- `test/term_ui/widgets/command_palette_test.exs` - Tests
- `examples/command_palette/` - Example application

### Command Structure

```elixir
%{
  id: atom(),
  label: String.t(),
  description: String.t() | nil,
  shortcut: String.t() | nil,
  category: atom() | nil,
  action: (-> term()) | {:submenu, [command()]} | {:async, (String.t() -> [command()])},
  icon: String.t() | nil,
  enabled: boolean() | (-> boolean())
}
```

### Category Prefixes

- `>` - Commands (default)
- `@` - Symbols/Go to
- `#` - Topics/Tags
- `:` - Line numbers/Locations

### State Structure

```elixir
%{
  commands: [command()],
  filtered_commands: [command()],
  query: String.t(),
  selected_index: integer(),
  recent_commands: [atom()],
  max_recent: integer(),
  visible: boolean(),
  loading: boolean(),
  category_filter: atom() | nil,
  on_select: callback,
  on_close: callback,
  submenu_stack: [%{parent_id: atom(), commands: [command()]}]
}
```

### Fuzzy Search Algorithm

Score components:
1. Exact match: +100
2. Prefix match: +50
3. Word boundary match: +30
4. Consecutive character match: +20
5. Character match: +10
6. Distance penalty: -5 per gap

## Implementation Plan

### Step 1: Core Structure
- [x] Create CommandPalette module with StatefulComponent
- [x] Define command structure and state
- [x] Implement init/1 with command registration
- [x] Basic modal overlay rendering

### Step 2: Fuzzy Search
- [x] Implement fuzzy matching algorithm
- [x] Implement scoring system
- [x] Implement match highlighting
- [x] Implement filtering on query change

### Step 3: Category Prefixes
- [x] Parse query for category prefix
- [x] Filter commands by category
- [x] Display category indicator
- [x] Handle prefix switching

### Step 4: Navigation
- [x] Up/Down arrow navigation through results
- [x] Enter to select/execute command
- [x] Escape to close palette
- [x] Page Up/Down for quick scroll

### Step 5: Recent Commands
- [x] Track recently executed commands
- [x] Show recent commands when query is empty
- [x] Persist recent commands (optional)
- [x] Clear recent commands API

### Step 6: Keyboard Shortcut Hints
- [x] Display shortcut in command row
- [x] Align shortcuts to right edge
- [x] Handle missing shortcuts gracefully

### Step 7: Nested Command Menus
- [x] Support submenu action type
- [x] Push/pop submenu stack
- [x] Backspace to go back
- [x] Breadcrumb display

### Step 8: Async Command Loading
- [x] Support async action type
- [x] Show loading indicator
- [x] Handle async results
- [x] Error handling for failed loads

### Step 9: Tests
- [x] Unit tests for fuzzy search
- [x] Navigation tests
- [x] Category filter tests
- [x] Recent commands tests
- [x] Submenu tests
- [x] Async loading tests

### Step 10: Example Application
- [x] Create command_palette example
- [x] Demo all command types
- [x] Demo categories
- [x] Demo nested menus

## Success Criteria

- [x] Modal overlay renders correctly
- [x] Fuzzy search ranks results appropriately
- [x] Category prefixes filter correctly
- [x] Recent commands tracked and displayed
- [x] Shortcut hints visible
- [x] Nested menus work with back navigation
- [x] Async loading shows indicator
- [x] Comprehensive test coverage (49 tests)
- [x] Working example application

## Current Status

**Status**: Complete

**What Works**:
- Modal overlay with configurable width
- Fuzzy search with scoring algorithm
- Category prefixes (>, @, #, :)
- Recent commands tracking
- Keyboard shortcut hints
- Nested command menus with breadcrumbs
- Async command loading

**Test Coverage**:
- 49 tests, all passing
- Tests cover fuzzy search, navigation, categories, recent commands, submenus, async loading
