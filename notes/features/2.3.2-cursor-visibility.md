# Feature: Task 2.3.2 - Implement hide_cursor/1 and show_cursor/1 Callbacks

**Branch:** `feature/2.3.2-cursor-visibility`
**Base:** `multi-renderer`
**Date:** 2025-12-05

## Overview

Implement cursor visibility control callbacks for the Raw backend. These callbacks hide and show the terminal cursor using ANSI escape sequences, with idempotent behavior to avoid unnecessary terminal I/O.

## Reference

See `notes/planning/multi-renderer/phase-02-raw-backend.md` Section 2.3.2.

## Tasks

### Implementation

- [x] 2.3.2.1 Implement `@impl true` `hide_cursor/1` writing `\e[?25l`
- [x] 2.3.2.2 Update `cursor_visible` to `false` in state
- [x] 2.3.2.3 Implement `@impl true` `show_cursor/1` writing `\e[?25h`
- [x] 2.3.2.4 Update `cursor_visible` to `true` in state
- [x] 2.3.2.5 Make operations idempotent (no-op if already in desired state)

### Unit Tests

- [x] Test `hide_cursor/1` updates state to `cursor_visible: false`
- [x] Test `show_cursor/1` updates state to `cursor_visible: true`
- [x] Test `hide_cursor/1` is idempotent (no-op when already hidden)
- [x] Test `show_cursor/1` is idempotent (no-op when already visible)
- [x] Test cursor visibility operations preserve other state fields
- [x] Test hide/show round-trip cycles

## Files Modified

- `lib/term_ui/backend/raw.ex` - Implemented `hide_cursor/1` and `show_cursor/1`
- `test/term_ui/backend/raw_test.exs` - Added 10 tests for cursor visibility

## Design Notes

### Idempotent Behavior

The key design decision is making these operations idempotent:
- If cursor is already hidden, `hide_cursor/1` returns state unchanged (no I/O)
- If cursor is already visible, `show_cursor/1` returns state unchanged (no I/O)

This optimization:
1. Reduces unnecessary terminal I/O
2. Allows callers to call hide/show without tracking current state
3. Follows common TUI framework patterns

### Implementation Pattern

Used pattern matching on struct fields for idempotent checks:

```elixir
def hide_cursor(%__MODULE__{cursor_visible: false} = state) do
  # Already hidden - idempotent no-op
  {:ok, state}
end

def hide_cursor(state) do
  write_to_terminal(ANSI.cursor_hide())
  {:ok, %{state | cursor_visible: false}}
end
```

### ANSI Sequences

- Hide cursor: `\e[?25l` (DECTCEM - DEC Text Cursor Enable Mode off)
- Show cursor: `\e[?25h` (DECTCEM on)

## Verification

1. `mix compile` - no warnings ✓
2. `mix test test/term_ui/backend/raw_test.exs` - all 69 tests pass ✓
3. `mix format --check-formatted` - code formatted ✓
