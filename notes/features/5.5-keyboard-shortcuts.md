# Feature Plan: Section 5.5 - Keyboard Shortcuts

## Problem Statement

TermUI needs a keyboard shortcut system for quick access to actions. Users expect standard shortcuts (Ctrl+Q quit, Ctrl+S save) and custom bindings. Shortcuts must support modifiers, sequences, scopes, and conflict resolution.

## Solution Overview

Implement a shortcut system with five components:

1. **Shortcut Registry** - Store and lookup shortcuts
2. **Key Combination Matching** - Match key events against registered shortcuts
3. **Scoped Shortcuts** - Context-sensitive shortcut activation
4. **Shortcut Actions** - Execute functions or send messages
5. **Shortcut Discoverability** - List and format shortcuts for help

### Key Design Decisions

- **ETS-based registry** - Fast lookup for every key event
- **Priority-based conflict resolution** - Higher priority wins
- **Scope hierarchy** - Global → mode → component scoping
- **Sequence support** - Multi-key sequences like vim's `gg`

## Technical Details

### File Structure

```
lib/term_ui/
├── shortcut.ex              # Shortcut struct and registry
├── shortcut/
│   ├── matcher.ex           # Key combination matching
│   └── formatter.ex         # Display formatting
```

### Dependencies

- Section 5.1 Event types for key events

## Implementation Plan

### Task 5.5.1: Shortcut Registry

- [x] 5.5.1.1 Define Shortcut struct with key, modifiers, action, scope, priority
- [x] 5.5.1.2 Implement GenServer-based registry
- [x] 5.5.1.3 Implement `register/2` adding shortcut to registry
- [x] 5.5.1.4 Implement `match/3` finding action for key event

### Task 5.5.2: Key Combination Matching

- [x] 5.5.2.1 Implement modifier matching checking all required modifiers
- [x] 5.5.2.2 Implement sequence matching tracking partial sequences
- [x] 5.5.2.3 Implement sequence timeout canceling partial sequence
- [x] 5.5.2.4 Implement wildcard matching for any-key bindings

### Task 5.5.3: Scoped Shortcuts

- [x] 5.5.3.1 Implement scope types: global, mode, component
- [x] 5.5.3.2 Implement scope checking during shortcut lookup
- [x] 5.5.3.3 Implement scope context passing
- [x] 5.5.3.4 Implement priority-based conflict resolution

### Task 5.5.4: Shortcut Actions

- [x] 5.5.4.1 Implement function actions
- [x] 5.5.4.2 Implement message actions
- [x] 5.5.4.3 Implement command actions
- [x] 5.5.4.4 Implement action execution

### Task 5.5.5: Shortcut Discoverability

- [x] 5.5.5.1 Implement `list/0` returning all registered shortcuts
- [x] 5.5.5.2 Implement `list_for_scope/1` filtering by scope
- [x] 5.5.5.3 Implement shortcut formatting for display
- [x] 5.5.5.4 Implement help text association

### Unit Tests

- [x] Test shortcut registration stores correctly
- [x] Test shortcut lookup finds registered action
- [x] Test modifier matching requires all modifiers
- [x] Test sequence matching tracks multiple keys
- [x] Test scope checking filters shortcuts
- [x] Test action execution runs on match
- [x] Test shortcut listing returns all shortcuts
- [x] Test formatting produces readable output

## Success Criteria

1. Shortcuts register and lookup correctly
2. Modifiers match precisely
3. Sequences track across multiple keys
4. Scopes filter appropriately
5. Actions execute correctly
6. All unit tests pass

## Current Status

- **Planning**: Complete
- **Implementation**: Complete
- **Tests**: 27 tests passing
