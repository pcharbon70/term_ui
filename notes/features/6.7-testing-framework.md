# Feature Plan: Section 6.7 - Testing Framework

## Problem Statement

TermUI needs a comprehensive testing framework for developers to test their TUI components without actual terminal interaction. Currently, testing components requires either manual verification or complex setup with actual terminal I/O. This slows development and makes CI/CD integration difficult.

**Impact:** Without proper testing utilities, developers cannot:
- Write unit tests for components
- Automate UI testing in CI pipelines
- Verify component behavior after changes
- Debug rendering issues efficiently

## Solution Overview

Implement a testing framework that provides:
1. **Test Renderer** - Captures render output to a buffer for inspection
2. **Event Simulation** - Creates synthetic events for testing
3. **Assertion Helpers** - TUI-specific assertions with clear failure messages
4. **Component Test Harness** - Isolates components for focused testing

### Key Design Decisions
- Test renderer implements the same interface as real renderer but stores to buffer
- Events are created as proper structs that work with existing event system
- Assertions use ExUnit's pattern matching for clear error messages
- Test harness manages lifecycle and provides convenient API

## Technical Details

### File Locations
- `lib/term_ui/test/test_renderer.ex` - Test renderer implementation
- `lib/term_ui/test/event_simulator.ex` - Event simulation functions
- `lib/term_ui/test/assertions.ex` - TUI-specific assertions
- `lib/term_ui/test/component_harness.ex` - Component test harness

### Dependencies
- Existing `TermUI.Renderer.Cell` for buffer cells
- Existing event structs from `TermUI.Events`
- ExUnit for test integration

## Implementation Plan

### Task 6.7.1: Test Renderer
- [x] 6.7.1.1 Implement test renderer capturing to buffer
- [x] 6.7.1.2 Implement buffer inspection: `get_text_at(x, y, width)`
- [x] 6.7.1.3 Implement style inspection: `get_style_at(x, y)`
- [x] 6.7.1.4 Implement snapshot comparison for render output

### Task 6.7.2: Event Simulation
- [x] 6.7.2.1 Implement `simulate_key(key, modifiers)` creating key event
- [x] 6.7.2.2 Implement `simulate_click(x, y, button)` creating mouse event
- [x] 6.7.2.3 Implement `simulate_type(string)` for text input
- [x] 6.7.2.4 Implement event injection into runtime

### Task 6.7.3: Assertion Helpers
- [x] 6.7.3.1 Implement `assert_text(buffer, x, y, expected)` for content assertions
- [x] 6.7.3.2 Implement `assert_focused(component)` for focus assertions
- [x] 6.7.3.3 Implement `assert_state(component, path, expected)` for state assertions
- [x] 6.7.3.4 Implement `refute_*` variants for negative assertions

### Task 6.7.4: Component Test Helper
- [x] 6.7.4.1 Implement `mount_test(module, props)` creating test harness
- [x] 6.7.4.2 Implement `send_event(harness, event)` for event testing
- [x] 6.7.4.3 Implement `get_state(harness)` for state inspection
- [x] 6.7.4.4 Implement `get_render(harness)` for render output

### Unit Tests
- [x] Test test renderer captures output correctly
- [x] Test buffer inspection returns correct content
- [x] Test event simulation creates valid events
- [x] Test assertions produce clear failure messages
- [x] Test component harness mounts and renders

## Success Criteria

1. Test renderer captures all render output accurately
2. Event simulation creates valid events that components can handle
3. Assertions provide clear, actionable failure messages
4. Component harness enables isolated component testing
5. All tests pass with comprehensive coverage

## Notes/Considerations

- Test renderer should support both synchronous inspection and async waiting
- Event simulation should handle complex sequences (e.g., type string with modifiers)
- Assertions should follow ExUnit patterns for consistency
- Harness should clean up properly to avoid test pollution
