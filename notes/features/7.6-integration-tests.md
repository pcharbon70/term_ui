# Feature Plan: Section 7.6 - Integration Tests

## Problem Statement

Integration tests verify the complete input/output cycle works correctly. While we have unit tests for individual components, we need comprehensive tests that exercise:
- Full path from terminal input through event dispatch, state update, view rendering
- Dashboard example behavior (keyboard navigation, theme switching)
- Multi-component event flow and focus management

**Impact:** Without integration tests:
- Regressions in the event pipeline may go undetected
- Complex interactions between components aren't verified
- Dashboard example behavior isn't validated programmatically

## Solution Overview

Create a comprehensive integration test suite that tests the full event cycle:

```
Input → Event → Dispatch → Update → View → Render
```

### Key Design Decisions

1. **Test without actual terminal** - Use `skip_terminal: true` to test logic without terminal I/O
2. **Test dashboard component logic** - Verify Dashboard.App behavior in isolation
3. **Multi-component focus tests** - Test event routing between components
4. **Clean test isolation** - Each test cleans up properly

### Architecture

```
┌─────────────────┐     ┌───────────────┐     ┌──────────────┐
│ Integration     │ --> │ Runtime with  │ --> │ Component    │
│ Tests           │     │ skip_terminal │     │ State        │
└─────────────────┘     └───────────────┘     └──────────────┘
```

## Technical Details

### File Structure

```
test/term_ui/integration/
├── end_to_end_test.exs       # 7.6.1 - Full event cycles
├── dashboard_test.exs        # 7.6.2 - Dashboard component tests
└── multi_component_test.exs  # 7.6.3 - Multi-component focus/messaging
```

### Dependencies

- `TermUI.Runtime` - With skip_terminal option
- `TermUI.Event` - For creating test events
- `Dashboard.App` - Dashboard example component
- Existing test helpers

### Existing Infrastructure

Already have integration tests in `test/term_ui/integration/`:
- event_flow_test.exs
- event_system_test.exs
- focus_integration_test.exs
- component_hierarchy_test.exs

## Implementation Plan

### Task 7.6.1: End-to-End Event Tests ✅

- [x] 7.6.1.1 Test key press updates component state and display
- [x] 7.6.1.2 Test mouse click dispatches to correct component
- [x] 7.6.1.3 Test resize updates layout and re-renders
- [x] 7.6.1.4 Test quit command exits cleanly with terminal restored
- [x] 7.6.1.5 Test multiple rapid events are processed correctly

### Task 7.6.2: Dashboard Integration Tests ✅

- [x] 7.6.2.1 Test dashboard starts and renders initial display
- [x] 7.6.2.2 Test 'q' key quits the dashboard
- [x] 7.6.2.3 Test 't' key toggles theme and re-renders
- [x] 7.6.2.4 Test arrow keys navigate process list
- [x] 7.6.2.5 Test dashboard handles resize correctly
- [x] 7.6.2.6 Verify no terminal corruption after exit

### Task 7.6.3: Multi-Component Tests ✅

- [x] 7.6.3.1 Test focus changes route keyboard to new component
- [x] 7.6.3.2 Test mouse click on unfocused component gives focus
- [x] 7.6.3.3 Test broadcast events reach all components
- [x] 7.6.3.4 Test parent-child message passing works correctly
- [x] 7.6.3.5 Test command results return to correct component

### Unit Tests ✅

- [x] All 7.6.1 tests passing
- [x] All 7.6.2 tests passing
- [x] All 7.6.3 tests passing
- [x] Test suite runs without terminal corruption
- [x] Test isolation (each test cleans up properly)

## Success Criteria

1. End-to-end event tests pass
2. Dashboard integration tests pass
3. Multi-component tests pass
4. All tests clean up properly
5. No terminal corruption during test runs
6. All existing tests continue to pass

## Current Status

- **Planning**: Complete
- **Implementation**: Complete
- **Tests**: Complete (37 tests passing)

## Notes/Considerations

- Use `skip_terminal: true` for all integration tests
- Dashboard.App can be tested directly with Runtime
- Focus management tests may need mock components
- Tests should be async: false to avoid state interference
- Monitor process cleanup in each test
