# Feature Plan: Section 5.6 - Clipboard Integration

## Problem Statement

TermUI needs clipboard integration for copy and paste operations between TUI applications and the system clipboard. Users expect standard clipboard functionality: paste from other applications, copy selected text, and standard shortcuts (Ctrl+X/C/V). Clipboard operations must handle bracketed paste mode for incoming content and OSC 52 for writing to the clipboard.

## Solution Overview

Implement a clipboard system with four components:

1. **Bracketed Paste Handling** - Accumulate and deliver paste content
2. **Clipboard Writing** - OSC 52 sequence generation
3. **Selection Management** - Track selection state for copy operations
4. **Cut/Copy/Paste Commands** - Standard edit commands

### Key Design Decisions

- **Event-based paste** - Paste content delivered as Event.Paste
- **OSC 52 clipboard writing** - Cross-platform clipboard access where supported
- **Selection as component concern** - Components manage their own selection state
- **Commands for clipboard operations** - Integration with command system

## Technical Details

### File Structure

```
lib/term_ui/
├── clipboard.ex              # Clipboard utilities and OSC 52
├── clipboard/
│   └── selection.ex          # Selection state utilities
```

### Dependencies

- Section 5.1 Event types (Event.Paste)
- Section 5.3 Command system for clipboard commands

## Implementation Plan

### Task 5.6.1: Bracketed Paste Handling

- [x] 5.6.1.1 Implement paste event accumulation collecting content between markers
- [x] 5.6.1.2 Implement paste event delivery to focused component
- [x] 5.6.1.3 Implement paste timeout for incomplete pastes
- [x] 5.6.1.4 Route paste events through event system as PasteEvent

### Task 5.6.2: Clipboard Writing

- [x] 5.6.2.1 Implement OSC 52 clipboard write sequence generation
- [x] 5.6.2.2 Implement capability detection for OSC 52 support
- [x] 5.6.2.3 Implement write command for clipboard operations
- [x] 5.6.2.4 Implement fallback notification when clipboard not supported

### Task 5.6.3: Selection Management

- [x] 5.6.3.1 Implement selection state tracking start and end positions
- [x] 5.6.3.2 Implement selection expansion with Shift+arrow keys
- [x] 5.6.3.3 Implement selection clearing on navigation without Shift
- [x] 5.6.3.4 Implement copy command extracting selected content

### Task 5.6.4: Cut/Copy/Paste Commands

- [x] 5.6.4.1 Implement copy command writing selection to clipboard
- [x] 5.6.4.2 Implement paste command inserting from paste event
- [x] 5.6.4.3 Implement cut command combining copy and delete
- [x] 5.6.4.4 Register standard shortcuts for clipboard operations

### Unit Tests

- [x] Test paste event accumulates content correctly
- [x] Test paste event routes to focused component
- [x] Test clipboard write generates correct OSC 52 sequence
- [x] Test selection tracking maintains start/end positions
- [x] Test copy extracts selected content
- [x] Test paste inserts at cursor position
- [x] Test cut removes and copies selection

## Success Criteria

1. Paste events accumulate and deliver correctly
2. OSC 52 clipboard writing generates proper sequences
3. Selection state tracks positions correctly
4. Cut/copy/paste commands work as expected
5. All unit tests pass

## Current Status

- **Planning**: Complete
- **Implementation**: Complete
- **Tests**: 51 tests passing

