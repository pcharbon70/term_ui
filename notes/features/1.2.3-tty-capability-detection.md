# Feature 1.2.3: TTY Capability Detection

## Overview

Implement `detect_capabilities/0` to detect terminal capabilities when falling back to TTY mode. This provides graceful degradation information for the TTY backend.

## Reference

- Phase plan: `notes/planning/multi-renderer/phase-01-backend-selector.md`
- Task: 1.2.3 Implement TTY Capability Detection

## Subtasks

- [x] 1.2.3.1 Implement private `detect_capabilities/0` returning capabilities map
- [x] 1.2.3.2 Detect color depth via `$COLORTERM` ("truecolor"/"24bit") and `$TERM` patterns
- [x] 1.2.3.3 Detect Unicode support via `$LANG` environment variable
- [x] 1.2.3.4 Detect terminal dimensions via `:io.columns/0`, `:io.rows/0` with fallback
- [x] 1.2.3.5 Detect terminal presence via `:io.getopts/0` `:terminal` key
- [x] 1.2.3.6 Return map with keys: `:colors`, `:unicode`, `:dimensions`, `:terminal`

## Implementation Notes

### Color Depth Detection

Priority order for detecting color support:

1. **$COLORTERM** - Most reliable indicator
   - `"truecolor"` or `"24bit"` → `:true_color`

2. **$TERM** patterns
   - Contains `"-256color"` suffix → `:color_256`
   - Contains `"-direct"` suffix → `:true_color`
   - `"xterm"`, `"screen"`, `"vt100"`, etc. → `:color_16`
   - Unknown or empty → `:monochrome`

### Unicode Detection

Check `$LANG` environment variable:
- Contains `"UTF-8"` or `"UTF8"` (case-insensitive) → `true`
- Otherwise → `false`

### Terminal Dimensions

1. Try `:io.columns/0` and `:io.rows/0`
2. Both must succeed to return `{rows, cols}` tuple
3. Return `nil` if either fails

### Terminal Presence

Check `:io.getopts/0` for `:terminal` key:
- `{:ok, opts}` where `opts[:terminal]` is truthy → `true`
- Otherwise → `false`

## Testing Strategy

- Test each detection function independently with mocked environment
- Test the combined `detect_capabilities/0` function
- Test edge cases (missing env vars, unusual values)
- Verify return value format matches type spec

## Files Modified

- `lib/term_ui/backend/selector.ex` - Implement `detect_capabilities/0` with actual detection
- `test/term_ui/backend/selector_test.exs` - Add tests for capability detection
