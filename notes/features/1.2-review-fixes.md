# Feature: Section 1.2 Review Fixes

## Overview

Address all concerns and implement suggested improvements from the Section 1.2 code review (`notes/reviews/section-1.2-backend-selector-review.md`).

## Reference

- Review document: `notes/reviews/section-1.2-backend-selector-review.md`
- Implementation: `lib/term_ui/backend/selector.ex`
- Tests: `test/term_ui/backend/selector_test.exs`

## Concerns Addressed

- [x] 1. Add comment explaining defensive error handling (line 208-212)
- [x] 2. Remove redundant `== true` comparison (line 318)
- [x] 3. Add tests for `basic_terminal?/1` patterns (4 new test cases covering all 13 terminals)
- [x] 4. Test generic error path in `attempt_raw_mode/0` (2 tests in new describe block)

## Suggested Improvements Implemented

- [x] 5. Extract test helpers to reduce duplication (new `SelectorTestHelpers` module)
- [x] 6. Simplify nested if expression to use `cond` (lines 290-295)
- [x] 7. Add module attribute `@basic_terminals` for terminal types (line 126)

## Implementation Plan

### Phase 1: Code Fixes (selector.ex)

1. Add comment to generic error handling explaining it's defensive programming
2. Replace `== true` with direct boolean return
3. Simplify nested if to use cond
4. Extract terminal types to module attribute

### Phase 2: Test Helpers (test/support/)

1. Create `test/support/selector_test_helpers.ex`
2. Implement `with_env/2` helper for environment variable management
3. Implement `assert_valid_capabilities/1` helper
4. Implement `assert_valid_raw_state/1` helper

### Phase 3: Additional Tests

1. Add tests for all 13 terminal types in `basic_terminal?/1`
2. Add test documenting defensive error handling behavior
3. Refactor existing tests to use new helpers

## Files Modified

- `lib/term_ui/backend/selector.ex` - Code improvements
- `test/term_ui/backend/selector_test.exs` - New tests and refactoring
- `test/support/selector_test_helpers.ex` - New test helper module
- `test/test_helper.exs` - Load new helper module
