# Feature Plan: Section 5.4 - Mouse Support

## Problem Statement

TermUI needs mouse support for point-and-click interaction. Users expect to click buttons, drag sliders, scroll lists, and see hover feedback. Mouse events must route to the correct component based on position and propagate through the component hierarchy.

## Solution Overview

Implement complete mouse support with five components:

1. **Mouse Mode Activation** - Enable/disable terminal mouse tracking
2. **Mouse Event Routing** - Route events to components by position
3. **Drag and Drop** - Track mouse motion while button held
4. **Scroll Wheel** - Handle scroll events for scrollable components
5. **Mouse Cursors/Hover** - Hover detection and visual feedback

### Key Design Decisions

- **SGR Extended mode** - Use mode 1006 for accurate coordinates and press/release distinction
- **Position-based routing** - Use component bounds for hit testing
- **Drag state machine** - Track press → move → release sequence
- **Coordinate transformation** - Convert global to component-local coordinates

## Technical Details

### File Structure

```
lib/term_ui/
├── mouse.ex                # Mouse mode activation and utilities
├── mouse/
│   ├── tracker.ex          # Drag and hover state tracking
│   └── router.ex           # Position-based event routing
```

### Dependencies

- Phase 1 terminal sequences for mouse mode activation
- Phase 3 component bounds for hit testing
- Section 5.1 Event types for mouse events

## Implementation Plan

### Task 5.4.1: Mouse Mode Activation

- [x] 5.4.1.1 Implement `enable_mouse/0` activating normal tracking mode (1000)
- [x] 5.4.1.2 Implement `enable_mouse_motion/0` activating all-motion mode (1003)
- [x] 5.4.1.3 Implement SGR Extended mode activation (1006)
- [x] 5.4.1.4 Implement `disable_mouse/0` deactivating tracking on cleanup

### Task 5.4.2: Mouse Event Routing

- [x] 5.4.2.1 Implement position-based routing using component bounds
- [x] 5.4.2.2 Implement z-order handling routing to topmost component
- [x] 5.4.2.3 Implement coordinate transformation to component-local coordinates
- [x] 5.4.2.4 Implement mouse event bubbling from target to ancestors

### Task 5.4.3: Drag and Drop

- [x] 5.4.3.1 Implement drag state tracking button press and position
- [x] 5.4.3.2 Implement drag start event when motion begins after press
- [x] 5.4.3.3 Implement drag move events during motion with button held
- [x] 5.4.3.4 Implement drag end event on button release

### Task 5.4.4: Scroll Wheel

- [x] 5.4.4.1 Implement scroll wheel event detection
- [x] 5.4.4.2 Implement scroll event routing to component at cursor
- [x] 5.4.4.3 Implement scroll amount calculation
- [x] 5.4.4.4 Implement scroll direction constants

### Task 5.4.5: Mouse Cursors/Hover

- [x] 5.4.5.1 Implement hover detection for mouse enter/leave events
- [x] 5.4.5.2 Implement hover state tracking
- [x] 5.4.5.3 Implement component hover callbacks
- [x] 5.4.5.4 Document cursor feedback patterns

### Unit Tests

- [x] Test mouse mode activation sends correct escape sequences
- [x] Test mouse event routing finds correct component
- [x] Test coordinate transformation produces local coordinates
- [x] Test drag tracking maintains state through press-move-release
- [x] Test scroll wheel events detect direction
- [x] Test hover detection fires enter/leave events

## Success Criteria

1. Mouse modes activate/deactivate correctly
2. Events route to correct component by position
3. Coordinates transform to local space
4. Drag state tracks through sequence
5. Scroll events route correctly
6. Hover detection works
7. All unit tests pass

## Current Status

- **Planning**: Complete
- **Implementation**: Complete
- **Tests**: 41 tests passing
