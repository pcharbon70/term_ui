# Feature 1.3.2: Implement State Constructors

## Overview

Add constructor functions to the `TermUI.Backend.State` module to simplify state creation. These provide a cleaner API than direct struct creation and encapsulate the required fields logic.

## Reference

- Phase plan: `notes/planning/multi-renderer/phase-01-backend-selector.md`
- Task: 1.3.2 Implement State Constructors
- Depends on: Task 1.3.1 (State Structure) - completed

## Subtasks

- [x] 1.3.2.1 Implement `new/2` accepting `backend_module` and keyword options
- [x] 1.3.2.2 Implement `new_raw/1` convenience function for raw mode state
- [x] 1.3.2.3 Implement `new_tty/2` convenience function for TTY mode state with capabilities

## Implementation Notes

### Function Signatures

```elixir
@spec new(module(), keyword()) :: t()
def new(backend_module, opts \\ [])

@spec new_raw(term()) :: t()
def new_raw(backend_state \\ nil)

@spec new_tty(map(), term()) :: t()
def new_tty(capabilities, backend_state \\ nil)
```

### new/2

General-purpose constructor:
- Takes `backend_module` as first argument (required)
- Takes keyword options for remaining fields
- `:mode` is required in options
- Other fields use struct defaults if not provided

```elixir
State.new(TermUI.Backend.TTY, mode: :tty, capabilities: %{colors: :true_color})
```

### new_raw/1

Convenience constructor for raw mode:
- Sets `backend_module` to `TermUI.Backend.Raw`
- Sets `mode` to `:raw`
- Sets `capabilities` to empty map
- Accepts optional `backend_state`

```elixir
State.new_raw()
State.new_raw(%{raw_mode_started: true})
```

### new_tty/2

Convenience constructor for TTY mode:
- Sets `backend_module` to `TermUI.Backend.TTY`
- Sets `mode` to `:tty`
- Takes `capabilities` map as first argument
- Accepts optional `backend_state`

```elixir
State.new_tty(%{colors: :color_256, unicode: true})
State.new_tty(%{colors: :true_color}, %{some: :state})
```

## Testing Strategy

- Test `new/2` with valid backend module and mode
- Test `new/2` raises when mode is missing
- Test `new/2` with all optional fields
- Test `new_raw/0` creates correct default state
- Test `new_raw/1` accepts backend_state
- Test `new_tty/1` creates correct state with capabilities
- Test `new_tty/2` accepts backend_state
- Test all constructors set `initialized` to `false`

## Files Modified

- `lib/term_ui/backend/state.ex` - Add constructor functions
- `test/term_ui/backend/state_test.exs` - Add constructor tests
